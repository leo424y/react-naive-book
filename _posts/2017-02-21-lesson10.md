---
layout: post
title: å…ƒä»¶çš„ state å’Œ setState
description: React.js å°æ›¸æ˜¯ä¸€å€‹é–‹æºã€å…è²»ã€å°ˆæ¥­ã€ç°¡å–®çš„ React.js æ•™ç¨‹ã€‚ä¸€å€‹å…ƒä»¶å¯ä»¥æ“æœ‰è‡ªå·±çš„ç‹€æ…‹ï¼Œstate å°±æ˜¯ç”¨ä¾†å„²å­˜é€™ç¨®å¯è®ŠåŒ–çš„ç‹€æ…‹çš„ã€‚æœ¬æ–‡ä»‹ç´¹ state å’Œ setState çš„ç”¨æ³•ã€‚
tags: [React.js,React.js å°æ›¸,æ•™ç¨‹,state,setState]
---

<ul style='font-size: 14px;'>
  <li>
    ä½œè€…ï¼š<a href="https://www.zhihu.com/people/hu-zi-da-ha" target="_blank">é¬å­å¤§å“ˆ</a>
  </li>
  <li>
    åŸæ–‡é€£çµï¼š<a href="http://huziketang.com/books/react{{ page.url }}"> http://huziketang.com/books/react{{ page.url }} </a>
  </li>
  <li>è½‰è¼‰è«‹è¨»æ˜å‡ºè™•ï¼Œä¿ç•™åŸæ–‡é€£çµå’Œä½œè€…è³‡è¨Šã€‚</li>
</ul>

## state
æˆ‘å€‘å‰é¢æåˆ°éï¼Œä¸€å€‹å…ƒä»¶çš„é¡¯ç¤ºå½¢æ…‹æ˜¯å¯ä»¥ç”±å®ƒè³‡æ–™ç‹€æ…‹å’Œé…ç½®åƒæ•¸æ±ºå®šçš„ã€‚ä¸€å€‹å…ƒä»¶å¯ä»¥æ“æœ‰è‡ªå·±çš„ç‹€æ…‹ï¼Œå°±åƒä¸€å€‹é»è´ŠæŒ‰éˆ•ï¼Œå¯ä»¥æœ‰â€œå·²é»è´Šâ€å’Œâ€œæœªé»è´Šâ€ç‹€æ…‹ï¼Œä¸¦ä¸”å¯ä»¥åœ¨é€™å…©ç¨®ç‹€æ…‹ä¹‹é–“é€²è¡Œåˆ‡æ›ã€‚React.js çš„ `state` å°±æ˜¯ç”¨ä¾†å„²å­˜é€™ç¨®å¯è®ŠåŒ–çš„ç‹€æ…‹çš„ã€‚

<a href="http://huzidaha.github.io/static/assets/img/posts/B7575C67-64F8-4A13-9C63-4D6805FA360D.png" target="_blank">![React.js å°æ›¸æ•™ç¨‹åœ–ç‰‡](http://huzidaha.github.io/static/assets/img/posts/B7575C67-64F8-4A13-9C63-4D6805FA360D.png)</a>

æˆ‘å€‘é‚„æ˜¯æ‹¿é»è´ŠæŒ‰éˆ•åšä¾‹å­ï¼Œå®ƒå…·æœ‰å·²é»è´Šå’Œæœªé»è´Šå…©ç¨®ç‹€æ…‹ã€‚é‚£éº¼å°±å¯ä»¥æŠŠé€™å€‹ç‹€æ…‹å„²å­˜åœ¨ state ä¸­ã€‚ä¿®æ”¹ `src/index.js` ç‚ºï¼š

```javascript
import React, { Component } from 'react'
import ReactDOM from 'react-dom'
import './index.css'

class LikeButton extends Component {
  function Object() { [native code] } () {
    super()
    this.state = { isLiked: false }
  }

  handleClickOnLikeButton () {
    this.setState({
      isLiked: !this.state.isLiked
    })
  }

  render () {
    return (
      <button onClick={this.handleClickOnLikeButton.bind(this)}>
        {this.state.isLiked ? 'å–æ¶ˆ' : 'é»è´Š'} ğŸ‘
      </button>
    )
  }
}
...
```

`isLiked` å­˜æ”¾åœ¨ä¾‹é …çš„ `state` ç‰©ä»¶ç•¶ä¸­ï¼Œé€™å€‹ç‰©ä»¶åœ¨å»ºæ§‹å‡½å¼è£¡é¢åˆå§‹åŒ–ã€‚é€™å€‹å…ƒä»¶çš„ `render` å‡½æ•¸å…§ï¼Œæœƒæ ¹æ“šå…ƒä»¶çš„ `state` çš„ä¸­çš„`isLiked`ä¸åŒé¡¯ç¤ºâ€œå–æ¶ˆâ€æˆ–â€œé»è´Šâ€å…§å®¹ã€‚ä¸¦ä¸”çµ¦ `button` åŠ ä¸Šäº†é»é¸çš„äº‹ä»¶ç›£è½ã€‚

æœ€å¾Œæ§‹å»ºä¸€å€‹ `Index` ï¼Œåœ¨å®ƒçš„ `render` å‡½æ•¸å…§ä½¿ç”¨ `LikeButton` ã€‚ç„¶å¾ŒæŠŠ `Index` æ¸²æŸ“åˆ°é é¢ä¸Šï¼š

```javascript
...
class Index extends Component {
  render () {
    return (
      <div>
        <LikeButton />
      </div>
    )
  }
}

ReactDOM.render(
  <Index />,
  document.getElementById('root')
)
```

## setState æ¥å—ç‰©ä»¶åƒæ•¸
åœ¨ `handleClickOnLikeButton` äº‹ä»¶ç›£è½å‡½æ•¸è£¡é¢ï¼Œå¤§å®¶å¯ä»¥ç•™æ„åˆ°ï¼Œæˆ‘å€‘å‘¼å«äº† `setState` å‡½æ•¸ï¼Œæ¯æ¬¡é»é¸éƒ½æœƒæ›´æ–° `isLiked` å±¬æ€§ç‚º `!isLiked`ï¼Œé€™æ¨£å°±å¯ä»¥åšåˆ°é»è´Šå’Œå–æ¶ˆåŠŸèƒ½ã€‚

`setState` æ–¹æ³•ç”±çˆ¶é¡ `Component` æ‰€æä¾›ã€‚*ç•¶æˆ‘å€‘å‘¼å«é€™å€‹å‡½æ•¸çš„æ™‚å€™ï¼ŒReact.js æœƒæ›´æ–°å…ƒä»¶çš„ç‹€æ…‹ `state` ï¼Œä¸¦ä¸”é‡æ–°å‘¼å« `render` æ–¹æ³•ï¼Œç„¶å¾Œå†æŠŠ `render` æ–¹æ³•æ‰€æ¸²æŸ“çš„æœ€æ–°çš„å…§å®¹é¡¯ç¤ºåˆ°é é¢ä¸Š*ã€‚

æ³¨æ„ï¼Œç•¶æˆ‘å€‘è¦æ”¹è®Šå…ƒä»¶çš„ç‹€æ…‹çš„æ™‚å€™ï¼Œä¸èƒ½ç›´æ¥ç”¨ `this.state = xxx`  é€™ç¨®æ–¹å¼ä¾†ä¿®æ”¹ï¼Œå¦‚æœé€™æ¨£åš React.js å°±æ²’è¾¦æ³•çŸ¥é“ä½ ä¿®æ”¹äº†å…ƒä»¶çš„ç‹€æ…‹ï¼Œå®ƒä¹Ÿå°±æ²’æœ‰è¾¦æ³•æ›´æ–°é é¢ã€‚æ‰€ä»¥ï¼Œä¸€å®šè¦ä½¿ç”¨ React.js æä¾›çš„ `setState` æ–¹æ³•ï¼Œ*å®ƒæ¥å—ä¸€å€‹ç‰©ä»¶æˆ–è€…å‡½æ•¸ä½œç‚ºåƒæ•¸*ã€‚

å‚³å…¥ä¸€å€‹ç‰©ä»¶çš„æ™‚å€™ï¼Œé€™å€‹ç‰©ä»¶è¡¨ç¤ºè©²å…ƒä»¶çš„æ–°ç‹€æ…‹ã€‚ä½†ä½ åªéœ€è¦å‚³å…¥éœ€è¦æ›´æ–°çš„éƒ¨åˆ†å°±å¯ä»¥äº†ï¼Œè€Œä¸éœ€è¦å‚³å…¥æ•´å€‹ç‰©ä»¶ã€‚ä¾‹å¦‚ï¼Œå‡è¨­ç¾åœ¨æˆ‘å€‘æœ‰å¦å¤–ä¸€å€‹ç‹€æ…‹ `name` ï¼š

```javascript
...
  function Object() { [native code] } (props) {
    super(props)
    this.state = {
      name: 'Tomy',
      isLiked: false
    }
  }

  handleClickOnLikeButton () {
    this.setState({
      isLiked: !this.state.isLiked
    })
  }
...
```

å› ç‚ºé»é¸çš„æ™‚å€™æˆ‘å€‘ä¸¦ä¸éœ€è¦ä¿®æ”¹ `name`ï¼Œæ‰€ä»¥åªéœ€è¦å‚³å…¥ `isLiked` å°±è¡Œäº†ã€‚Tomy é‚„æ˜¯é‚£å€‹ Tomyï¼Œè€Œ `isLiked` å·²ç¶“ä¸æ˜¯é‚£å€‹ `isLiked` äº†ã€‚

## setState æ¥å—å‡½æ•¸åƒæ•¸
é€™è£¡é‚„æœ‰è¦æ³¨æ„çš„æ˜¯ï¼Œç•¶ä½ å‘¼å« `setState` çš„æ™‚å€™ï¼Œ*React.js ä¸¦ä¸æœƒé¦¬ä¸Šä¿®æ”¹ state*ã€‚è€Œæ˜¯æŠŠé€™å€‹ç‰©ä»¶æ”¾åˆ°ä¸€å€‹æ›´æ–°ä½‡åˆ—è£¡é¢ï¼Œç¨å¾Œæ‰æœƒå¾ä½‡åˆ—ç•¶ä¸­æŠŠæ–°çš„ç‹€æ…‹æå–å‡ºä¾†åˆä½µåˆ° `state` ç•¶ä¸­ï¼Œç„¶å¾Œå†è§¸ç™¼å…ƒä»¶æ›´æ–°ã€‚é€™ä¸€é»è¦å¥½å¥½æ³¨æ„ã€‚å¯ä»¥é«”æœƒä¸€ä¸‹ä¸‹é¢çš„ç¨‹å¼ç¢¼ï¼š

```javascript
...
  handleClickOnLikeButton () {
    console.log(this.state.isLiked)
    this.setState({
      isLiked: !this.state.isLiked
    })
    console.log(this.state.isLiked)
  }
...
```

ä½ æœƒç™¼ç¾å…©æ¬¡åˆ—å°çš„éƒ½æ˜¯ `false`ï¼Œå³ä½¿æˆ‘å€‘ä¸­é–“å·²ç¶“ `setState` éä¸€æ¬¡äº†ã€‚é€™ä¸¦ä¸æ˜¯ä»€éº¼ bugï¼Œåªæ˜¯ React.js çš„ `setState` æŠŠä½ çš„å‚³é€²ä¾†çš„ç‹€æ…‹å¿«å–èµ·ä¾†ï¼Œç¨å¾Œæ‰æœƒå¹«ä½ æ›´æ–°åˆ° `state` ä¸Šï¼Œæ‰€ä»¥ä½ ç²å–åˆ°çš„é‚„æ˜¯åŸä¾†çš„ `isLiked`ã€‚

æ‰€ä»¥å¦‚æœä½ æƒ³åœ¨ `setState` ä¹‹å¾Œä½¿ç”¨æ–°çš„ `state` ä¾†åšå¾ŒçºŒé‹ç®—å°±åšä¸åˆ°äº†ï¼Œä¾‹å¦‚ï¼š

```javascript
...
  handleClickOnLikeButton () {
    this.setState({ count: 0 }) // => this.state.count é‚„æ˜¯ undefined
    this.setState({ count: this.state.count + 1}) // => undefined + 1 = NaN
    this.setState({ count: this.state.count + 2}) // => NaN + 2 = NaN
  }
...
```

ä¸Šé¢çš„ç¨‹å¼ç¢¼çš„åŸ·è¡Œçµæœä¸¦ä¸èƒ½é”åˆ°æˆ‘å€‘çš„é æœŸï¼Œæˆ‘å€‘å¸Œæœ› `count` åŸ·è¡Œçµæœæ˜¯ `3` ï¼Œå¯æ˜¯æœ€å¾Œå¾—åˆ°çš„æ˜¯ `NaN`ã€‚ä½†æ˜¯é€™ç¨®å¾ŒçºŒæ“ä½œä¾è³´å‰ä¸€å€‹ `setState` çš„çµæœçš„æƒ…æ³ä¸¦ä¸ç½•è¦‹ã€‚

é€™è£¡å°±è‡ªç„¶åœ°å¼•å‡ºäº† `setState` çš„ç¬¬äºŒç¨®ä½¿ç”¨æ–¹å¼ï¼Œå¯ä»¥æ¥å—ä¸€å€‹å‡½æ•¸ä½œç‚ºåƒæ•¸ã€‚React.js æœƒæŠŠä¸Šä¸€å€‹ `setState` çš„çµæœå‚³å…¥é€™å€‹å‡½æ•¸ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨è©²çµæœé€²è¡Œé‹ç®—ã€æ“ä½œï¼Œç„¶å¾Œè¿”å›ä¸€å€‹ç‰©ä»¶ä½œç‚ºæ›´æ–° `state` çš„ç‰©ä»¶ï¼š

```javascript
...
  handleClickOnLikeButton () {
    this.setState((prevState) => {
      return { count: 0 }
    })
    this.setState((prevState) => {
      return { count: prevState.count + 1 } // ä¸Šä¸€å€‹ setState çš„è¿”å›æ˜¯ count ç‚º 0ï¼Œç•¶å‰è¿”å› 1
    })
    this.setState((prevState) => {
      return { count: prevState.count + 2 } // ä¸Šä¸€å€‹ setState çš„è¿”å›æ˜¯ count ç‚º 1ï¼Œç•¶å‰è¿”å› 3
    })
    // æœ€å¾Œçš„çµæœæ˜¯ this.state.count ç‚º 3
  }
...
```

é€™æ¨£å°±å¯ä»¥é”åˆ°ä¸Šè¿°çš„*åˆ©ç”¨ä¸Šä¸€æ¬¡ `setState` çµæœé€²è¡Œé‹ç®—*çš„æ•ˆæœã€‚

## setState åˆä½µ
ä¸Šé¢æˆ‘å€‘é€²è¡Œäº†ä¸‰æ¬¡ `setState`ï¼Œä½†æ˜¯å¯¦éš›ä¸Šå…ƒä»¶åªæœƒé‡æ–°æ¸²æŸ“ä¸€æ¬¡ï¼Œè€Œä¸æ˜¯ä¸‰æ¬¡ï¼›é€™æ˜¯å› ç‚ºåœ¨ React.js å…§éƒ¨æœƒæŠŠ JavaScript äº‹ä»¶è¿´åœˆä¸­çš„è¨Šæ¯ä½‡åˆ—çš„åŒä¸€å€‹è¨Šæ¯ä¸­çš„ `setState` éƒ½é€²è¡Œåˆä½µä»¥å¾Œå†é‡æ–°æ¸²æŸ“å…ƒä»¶ã€‚

æ·±å±¤çš„åŸç†ä¸¦ä¸éœ€è¦éå¤šç³¾çµï¼Œä½ åªéœ€è¦è¨˜ä½çš„æ˜¯ï¼šåœ¨ä½¿ç”¨ React.js çš„æ™‚å€™ï¼Œä¸¦ä¸éœ€è¦æ“”å¿ƒå¤šæ¬¡é€²è¡Œ `setState` æœƒå¸¶ä¾†æ•ˆèƒ½å•é¡Œã€‚
